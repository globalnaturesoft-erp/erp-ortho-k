<% if @products.count == 0 %>
    <div class="alert alert-warning">
        <p>Không tìm thấy hàng cần chuyển kho</p>
    </div>
<% elsif @from_warehouse.present? and @to_warehouse.present? and @transfer_quantity.present? and @condition_value.present? and @state.present? %>
    <table class="table table-bordered table-advance order-column" id="">
        <tr>
            <th class="bg-grey text-center" width="1%"><%= t('.number') %></th>
            <th class="bg-grey"><%= t('.code') %></th>
            <th class="bg-grey"><%= t('.name') %></th>
            <th class="bg-grey text-center">Kho xuất: <%= @from_warehouse.name %></th>
            <th class="bg-grey text-center">Kho nhập: <%= @to_warehouse.name %></th>
            <th class="bg-grey text-center"><%= t('.transfer_quantity') %></th>
        </tr>
        <% @products.each_with_index do |product,index| %>
            <%
                if @condition == 'from_redundant'
                    from = Erp::Products::CacheStock.where(product_id: product.id)
                        .where(warehouse_id: @from_warehouse.id)
                        .where(state_id: @state.id).first.stock
                    to = Erp::Products::CacheStock.where(product_id: product.id)
                        .where(warehouse_id: @to_warehouse.id)
                        .where(state_id: @state.id).first.stock
                    transfer = (@transfer_quantity.to_i > from ? from : @transfer_quantity.to_i)
                else
                    to = Erp::Products::CacheStock.where(product_id: product.id)
                        .where(warehouse_id: @to_warehouse.id)
                        .where(state_id: @state.id).first.stock
                    from = Erp::Products::CacheStock.where(product_id: product.id)
                        .where(warehouse_id: @from_warehouse.id)
                        .where(state_id: @state.id).first.stock
                    transfer = from > @transfer_quantity.to_i ? @transfer_quantity.to_i : from
                end
            %>
            <% if transfer > 0 %>
                <tr>
                    <td class="text-center"><%= index+1 %></td>
                    <td class=""><%= product.code %></td>
                    <td class=""><%= product.name %></td>
                    <td class="text-center">
                        <%= from %>
                    </td>
                    <td class="text-center"><%= to %></td>
                    <td class="text-center bg-warning">
                        <%= transfer %>
                    </td>
                </tr>
            <% end %>
        <% end %>
    </table>
<% else %>
    <div class="alert alert-warning">
        <p>Vui lòng chọn các tham số bắt buộc:
            <br>- <strong>Kho xuất</strong>
            <br>- <strong>Kho nhập</strong>
            <br>- <strong>Trạng thái</strong>
            <br>- <strong>Điều kiện, tham số chuyển kho</strong>
            <br>- <strong>Số lượng chyuển</strong>
        </p>
    </div>
<% end %>
