<% if params[:global_filter][:from_date].present? and params[:global_filter][:to_date].present? %>
    <% if @group_by_category.nil? and @group_by_property.nil? %>
        <table class="table table-bordered table-advance order-column" id="">
            <tr>
                <td class="text-right" colspan="3"><%= t('.total_row') %></td>



                <td class="text-center stock-num text-bold bg-warning">
                    <%
                        begin_params = @global_filters.clone
                        begin_params[:to_date] = @global_filters[:from_date]
                        begin_params[:from_date] = nil
                        begin_params[:product_id] = @products_query.select('id')
                    %>
                    <%= Erp::Products::Product.get_stock_real(begin_params) %>
                </td>

                <% total_import = 0 %>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_qdelivery_import(@global_filters.merge({
                            product_id: @products_query.select('id'),
                            delivery_type: Erp::Qdeliveries::Delivery::TYPE_WAREHOUSE_IMPORT
                        }))
                        total_import += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_qdelivery_import(@global_filters.merge({
                            product_id: @products_query.select('id'),
                            delivery_type: Erp::Qdeliveries::Delivery::TYPE_CUSTOMER_IMPORT
                        }))
                        total_import += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_transfer_import(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_import += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    --
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_stock_check_import(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_import += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num text-bold text-warning">
                    <%= total_import %>
                </td>




                <% total_export = 0 %>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_qdelivery_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                            delivery_type: Erp::Qdeliveries::Delivery::TYPE_WAREHOUSE_EXPORT
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_qdelivery_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                            delivery_type: Erp::Qdeliveries::Delivery::TYPE_MANUFACTURER_EXPORT
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_transfer_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_gift_given_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_damage_record_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num">
                    <%
                        count = Erp::Products::Product.get_stock_check_export(@global_filters.merge({
                            product_id: @products_query.select('id'),
                        }))
                        total_export += count
                    %>
                    <%= count %>
                </td>
                <td class="text-center stock-num text-bold text-primary">
                    <%= total_export %>
                </td>



                <td class="text-center stock-num text-bold bg-info">
                    <%
                        end_params = @global_filters.clone
                        end_params[:from_date] = nil
                        end_params[:product_id] = @products_query.select('id')
                    %>
                    <%= Erp::Products::Product.get_stock_real(end_params) %>
                </td>
            </tr>
            <tr>
                <th class="bg-grey text-center" rowspan="2"><%= t('.product') %></th>
                <th class="bg-grey text-center" rowspan="2"><%= t('.diameter') %></th>
                <th class="bg-grey text-center" rowspan="2"><%= t('.category') %></th>
                <th class="bg-grey text-center" rowspan="2" width="7%"><%= t('.begin') %></th>
                <th class="bg-grey text-center" colspan="6"><%= t('.import') %></th>
                <th class="bg-grey text-center text-center" colspan="7"><%= t('.export') %></th>
                <th class="bg-grey text-center"><%= t('.end') %></th>
            </tr>
            <tr>
                <th class="bg-grey text-center" width="7%" title="Nhập kho"><%= t('.import_purchase') %></th>
                <th class="bg-grey text-center" width="7%" title="Hoàn kho (Khách hàng)"><%= t('.import_return') %></th>
                <th class="bg-grey text-center" width="7%" title="Chuyển kho">CK</th>
                <th class="bg-grey text-center" width="7%" title="Ký gởi/Cho mượn">KG</th>
                <th class="bg-grey text-center" width="7%" title="Kiểm kho">KK</th>
                <th class="bg-grey text-center" width="7%" title="Tổng cộng">Tổng</th>
                <th class="bg-grey text-center" width="7%" title="Xuất kho bán">XK</th>
                <th class="bg-grey text-center" width="7%" title="Trả nhà CC">TNCC</th>
                <th class="bg-grey text-center" width="7%" title="Chuyển kho">CK</th>
                <th class="bg-grey text-center" width="7%" title="Tặng quà">TQ</th>
                <th class="bg-grey text-center" width="7%" title="Hủy kho">HuyK</th>
                <th class="bg-grey text-center" width="7%" title="Kiểm kho">KK</th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_total') %></th>
            </tr>
            <% @products.each_with_index do |product,index| %>
                <tr>
                    <td class="text-left"><%= product.code %></td>
                    <td class="text-left"><%= product.get_diameter %></td>
                    <td class="text-left"><%= product.category_name %></td>
                    <td class="text-center stock-num text-bold bg-warning">
                        <%
                            begin_params = @global_filters.clone
                            begin_params[:to_date] = @global_filters[:from_date]
                            begin_params[:from_date] = nil
                        %>
                        <%= product.get_stock(begin_params) %>
                    </td>


                    <% total_import = 0 %>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_qdelivery_import(@global_filters.merge({
                                product_id: product.id,
                                delivery_type: Erp::Qdeliveries::Delivery::TYPE_WAREHOUSE_IMPORT
                            }))
                            total_import += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_qdelivery_import(@global_filters.merge({
                                product_id: product.id,
                                delivery_type: Erp::Qdeliveries::Delivery::TYPE_CUSTOMER_IMPORT
                            }))
                            total_import += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_transfer_import(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_import += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        --
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_stock_check_import(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_import += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num text-bold text-warning">
                        <%= total_import %>
                    </td>



                    <% total_export = 0 %>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_qdelivery_export(@global_filters.merge({
                                product_id: product.id,
                                delivery_type: Erp::Qdeliveries::Delivery::TYPE_WAREHOUSE_EXPORT
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_qdelivery_export(@global_filters.merge({
                                product_id: product.id,
                                delivery_type: Erp::Qdeliveries::Delivery::TYPE_MANUFACTURER_EXPORT
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_transfer_export(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_gift_given_export(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_damage_record_export(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num">
                        <%
                            count = Erp::Products::Product.get_stock_check_export(@global_filters.merge({
                                product_id: product.id,
                            }))
                            total_export += count
                        %>
                        <%= count %>
                    </td>
                    <td class="text-center stock-num text-bold text-primary">
                        <%= total_export %>
                    </td>


                    <td class="text-center stock-num text-bold bg-info">
                        <%
                            end_params = @global_filters.clone
                            end_params[:from_date] = nil
                        %>
                        <%= product.get_stock(end_params) %>
                    </td>
                </tr>
            <% end %>
        </table>
        <%= erp_datalist_pagination(@products) %>
    <% elsif @group_by_property.nil? %>
        <table class="table table-bordered table-advance order-column" id="">
            <tr>
                <td class="text-right"><%= t('.total_row') %></td>
                <td class="text-center stock-num text-bold bg-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-primary"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold bg-info"><%= (0..1000).to_a.sample %></td>
            </tr>
            <tr>
                <th class="bg-grey text-center" rowspan="2"><%= t('.category') %></th>
                <th class="bg-grey text-center" rowspan="2" width="7%"><%= t('.begin') %></th>
                <th class="bg-grey text-center" colspan="4"><%= t('.import') %></th>
                <th class="bg-grey text-center text-center" colspan="4"><%= t('.export') %></th>
                <th class="bg-grey text-center" colspan="2"><%= t('.end') %></th>
            </tr>
            <tr>
                <th class="bg-grey text-center" width="7%"><%= t('.import_purchase') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_return') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_sales') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_total') %></th>
            </tr>
            <% @categories.each_with_index do |category,index| %>
                <tr>
                    <td class="text-left"><%= category.name %></td>
                    <td class="text-center stock-num text-bold bg-warning"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold text-warning"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold text-primary"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold bg-info"><%= (0..5).to_a.sample %></td>
                </tr>
            <% end %>
        </table>
    <% elsif !@group_by_category.nil? %>
        <table class="table table-bordered table-advance order-column" id="">
            <tr>
                <td class="text-right" colspan="2"><%= t('.total_row') %></td>
                <td class="text-center stock-num text-bold bg-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-primary"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold bg-info"><%= (0..1000).to_a.sample %></td>
            </tr>
            <tr>
                <th class="bg-grey text-center" rowspan="2"><%= t('.category') %></th>
                <th class="bg-grey text-center" rowspan="2"><%= t('.property') %></th>
                <th class="bg-grey text-center" rowspan="2" width="7%"><%= t('.begin') %></th>
                <th class="bg-grey text-center" colspan="4"><%= t('.import') %></th>
                <th class="bg-grey text-center text-center" colspan="4"><%= t('.export') %></th>
                <th class="bg-grey text-center" colspan="2"><%= t('.end') %></th>
            </tr>
            <tr>
                <th class="bg-grey text-center" width="7%"><%= t('.import_purchase') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_return') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_sales') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_total') %></th>
            </tr>
            <% @categories.each_with_index do |category,index| %>
                <% rowspan = @properties_values.count %>
                <% @properties_values.each_with_index do |property_value,index| %>
                    <tr>
                        <% if index == 0 %>
                            <td class="text-left text-bold" rowspan="<%= rowspan %>"><%= category.name %></td>
                        <% end %>
                        <td class="text-left"><%= property_value.value %></td>
                        <td class="text-center stock-num text-bold bg-warning"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num text-bold text-warning"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num text-bold text-primary"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                        <td class="text-center stock-num text-bold bg-info"><%= (0..5).to_a.sample %></td>
                    </tr>
                <% end %>
            <% end %>
        </table>
    <% else %>
        <table class="table table-bordered table-advance order-column" id="">
            <tr>
                <td class="text-right"><%= t('.total_row') %></td>
                <td class="text-center stock-num text-bold bg-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-warning"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold text-primary"><%= (0..1000).to_a.sample %></td>
                <td class="text-center stock-num"><%= (50..1000).to_a.sample %></td>
                <td class="text-center stock-num text-bold bg-info"><%= (0..1000).to_a.sample %></td>
            </tr>
            <tr>
                <th class="bg-grey text-center" rowspan="2"><%= t('.property') %></th>
                <th class="bg-grey text-center" rowspan="2" width="7%"><%= t('.begin') %></th>
                <th class="bg-grey text-center" colspan="4"><%= t('.import') %></th>
                <th class="bg-grey text-center text-center" colspan="4"><%= t('.export') %></th>
                <th class="bg-grey text-center" colspan="2"><%= t('.end') %></th>
            </tr>
            <tr>
                <th class="bg-grey text-center" width="7%"><%= t('.import_purchase') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_return') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.import_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_sales') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_others') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.export_total') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_consigment') %></th>
                <th class="bg-grey text-center" width="7%"><%= t('.end_total') %></th>
            </tr>
            <% @properties_values.each_with_index do |properties_value,index| %>
                <tr>
                    <td class="text-left"><%= properties_value.value %></td>
                    <td class="text-center stock-num text-bold bg-warning"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold text-warning"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold text-primary"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num"><%= (0..5).to_a.sample %></td>
                    <td class="text-center stock-num text-bold bg-info"><%= (0..5).to_a.sample %></td>
                </tr>
            <% end %>
        </table>
    <% end %>
<% else %>
    <div class="alert alert-warning">
        <p>Vui lòng chọn các tham số bắt buộc:
            <br>- <strong>Từ ngày</strong>
            <br>- <strong>Đến ngày</strong>
        </p>
    </div>
<% end %>
