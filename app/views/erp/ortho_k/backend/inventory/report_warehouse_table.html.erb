  <div class="custom-show text-center">
      <h4 class="font-yellow bold uppercase mb-15">
          Báo cáo hàng tồn theo kho
          <% if @period.present? %>
              <%= @period.name %>
          <% else %>
              <%= 'Từ ' + @from_date.strftime('%d/%m/%Y') if !@from_date.nil? %> <%= ' Đến ' + @to_date.strftime('%d/%m/%Y') if !@to_date.nil? %>
          <% end %>
      </h4>
  </div>
  
  <div class="row">
    <div class="col-md-6">
      <div class="text-left mb-10">
          <h3 class="text-bold text-primary no-margin">
              <% if @warehouses.count > 0 %>
                <%= @warehouses.map(&:name).join(' + ').html_safe %>
              <% else %>
                Tất cả kho
              <% end %>
          </h3>
      </div>
    </div>
    <div class="col-md-6">
      <div class="text-right mb-10">
          <a target="_blank"
              href="<%= erp_ortho_k.report_warehouse_xlsx_backend_inventory_index_path(params.to_unsafe_hash.merge({format: 'xlsx'})) %>"
              target="_blank"
              class="btn btn-primary"
          >Xuất excel</a>
      </div>
    </div>
  </div>
  
  <table class="table table-bordered table-advance order-column">

    <tr>
      <td class="text-right bg-grey text-nowrap">Tổng cộng</td>
      <% Erp::Products::State.all.each do |state| %>
        <% product_ids = @product_query.select('id') %>
        <% product_ids = -1 if product_ids.count == 0 %>
        <% filters = @global_filters.clone.merge(product_id: product_ids, state: state) %>
        <td class="text-center bg-grey text-bold text-nowrap">
          <%
            end_params = filters.clone
            end_params[:from_date] = nil
          %>
          <%= Erp::Products::Product.get_stock_real(end_params) %>
        </td>
      <% end %>

      <% product_ids = @product_query.select('id') %>
      <% product_ids = -1 if product_ids.count == 0 %>
      <% filters = @global_filters.clone.merge(product_id: product_ids) %>
      <td class="text-center bg-grey text-bold text-nowrap">
        <%
          end_params = filters.clone
          end_params[:from_date] = nil
        %>
        <%= Erp::Products::Product.get_stock_real(end_params) %>
      </td>
    </tr>

    <tr>
      <th class="text-left bg-primary">Loại hàng</th>
      <% Erp::Products::State.all.each do |state| %>
        <th class="text-center bg-primary" width="10%"><%= state.name %></th>
      <% end %>
      <th class="text-center bg-primary">Tổng tồn kho</th>
    </tr>
    <% @categories.each do |category| %>
      <tr>
        <td class="text-left text-nowrap"><%= category.name %></td>
        <% Erp::Products::State.all.each do |state| %>
          <% product_ids = @product_query.select('id').where(category_id: category.id) %>
          <% product_ids = -1 if product_ids.count == 0 %>
          <% filters = @global_filters.clone.merge(product_id: product_ids, state: state) %>
          <th class="text-center text-nowrap">
            <%
              end_params = filters.clone
              end_params[:from_date] = nil
            %>
            <%= Erp::Products::Product.get_stock_real(end_params) %>
          </th>
        <% end %>

        <% product_ids = @product_query.select('id').where(category_id: category.id) %>
        <% product_ids = -1 if product_ids.count == 0 %>
        <% filters = @global_filters.clone.merge(product_id: product_ids) %>
        <td class="text-center text-bold text-nowrap">
          <%
            end_params = filters.clone
            end_params[:from_date] = nil
          %>
          <%= Erp::Products::Product.get_stock_real(end_params) %>
        </td>
      </tr>
    <% end %>
  </table>
