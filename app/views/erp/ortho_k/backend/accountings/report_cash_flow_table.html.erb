<% if params.to_unsafe_hash[:global_filter][:from_date].present? ||
      params.to_unsafe_hash[:global_filter][:to_date].present? ||
      params.to_unsafe_hash[:global_filter][:period].present? %>
    
    <div class="custom-show text-center">
        <h4 class="font-blue-madison bold uppercase mb-15">
            Bảng báo cáo dòng tiền <br>
            <span class="font-sm">
                <% if @period_name.nil? %>
                    <%= 'Từ ' + @from.strftime('%d/%m/%Y') if !@from.nil? %>
                    <%= !@to.nil? ? ' Đến ' + @to.strftime('%d/%m/%Y') : ' đến nay' %>
                <% else %>
                    <%= 'Trong ' + @period_name %>
                <% end %>
            </span>
        </h4>
    </div>
    
    <div class="text-right mb-10">
        <a target="_blank"
            href="<%= erp_ortho_k.report_cash_flow_xlsx_backend_accountings_path(params.to_unsafe_hash.merge({format: 'xlsx'})) %>"
            target="_blank"
            class="btn btn-primary"
        >Xuất excel</a>
    </div>
    
    <table class="table table-bordered order-column">
        <thead class="flip-content">
            <tr>
                <th width="40%"  class="text-center bg-yellow bg-font-yellow text-nowrap">Danh mục tài khoản</th>
                <th width="20%" class="text-center bg-yellow bg-font-yellow text-nowrap">Số dư đầu kỳ</th>
                <th width="20%" class="text-center bg-yellow bg-font-yellow text-nowrap">Số tiền thu</th>
                <th width="20%" class="text-center bg-yellow bg-font-yellow text-nowrap">Số tiền chi</th>
                <th width="20%" class="text-center bg-yellow bg-font-yellow text-nowrap">Số dư cuối kỳ</th>
            </tr>
        </thead>
        <tbody>
            <% @accounts.each do |account| %>
                <tr>
                    <td class="text-center"><%= account.name %></td>
                    <td class="text-center font-yellow-gold"><%= format_number(account.account_balance(to_date: (!@from.nil? ? (@from-1.day) : @from))) %></td>
                    <td class="text-center font-yellow-gold"><%= format_number(account.received(from_date: @from, to_date: @to)) %></td>
                    <td class="text-center font-yellow-gold"><%= format_number(account.paid(from_date: @from, to_date: @to)) %></td>
                    <td class="text-center font-yellow-gold"><%= format_number(account.account_balance(to_date: @to)) %></td>
                </tr>
            <% end %>
            <tr>
                <td class="text-center bold">TỔNG CỘNG</td>
                <td class="text-center bold"><%= format_number(@accounts.account_balance(to_date: (!@from.nil? ? (@from-1.day) : @from))) %></td>
                <td class="text-center bold"><%= format_number(@accounts.received(from_date: @from, to_date: @to)) %></td>
                <td class="text-center bold"><%= format_number(@accounts.paid(from_date: @from, to_date: @to)) %></td>
                <td class="text-center bold"><%= format_number(@accounts.account_balance(to_date: @to)) %></td>
            </tr>
            
        </tbody>
    </table>
<% else %>
    <div class="alert alert-warning"><%= t('.please_select_filter') %></div>
<% end %>