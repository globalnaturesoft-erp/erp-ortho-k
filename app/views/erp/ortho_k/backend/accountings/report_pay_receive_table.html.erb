<% total_colspan = (get_columns(params).include?("ordinal_number") ? 1 : 0) +
                (get_columns(params).include?("contact_name") ? 1 : 0) +
                (get_columns(params).include?("voucher_date") ? 1 : 0) +
                (get_columns(params).include?("pay_receive") ? 1 : 0) +
                (get_columns(params).include?("description") ? 1 : 0)
%>
<% if get_filters(params)['pay_receive'].present? &&
    (params.to_unsafe_hash[:global_filter][:from_date].present? ||
    params.to_unsafe_hash[:global_filter][:to_date].present? ||
    params.to_unsafe_hash[:global_filter][:period].present?) %>
    
    <div class="custom-show text-center">
        <h4 class="font-blue-madison bold uppercase mb-15">
            Báo cáo
            <%= 'Thu ' if get_filters(params)['pay_receive'].present? and get_filters(params)['pay_receive'].include?(Erp::Payments::PaymentRecord::TYPE_RECEIVE) %>
            <%= 'Chi ' if get_filters(params)['pay_receive'].present? and get_filters(params)['pay_receive'].include?(Erp::Payments::PaymentRecord::TYPE_PAY) %>
            tiền hàng <br>
            <span class="font-sm">
                <% if @period_name.nil? %>
                    (
                        <%= 'từ ' + @from.strftime('%d/%m/%Y') if !@from.nil? %>
                        <%= 'đến ' + @to.strftime('%d/%m/%Y') if !@to.nil? %>
                    )
                <% else %>
                    (<%= @period_name %>)
                <% end %>
            </span>
        </h4>
    </div>
    
    <div class="text-right mb-10">
        <a target="_blank"
            href="<%= erp_ortho_k.report_pay_receive_xlsx_backend_accountings_path(params.to_unsafe_hash.merge({format: 'xlsx'})) %>"
            target="_blank"
            class="btn btn-primary"
        >Xuất excel</a>
    </div>
    
    <table class="table table-bordered order-column">
        <thead class="flip-content">
            <tr>
                <% if get_columns(params).include?("ordinal_number") %>
                    <th width="2%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">STT</th>
                <% end %>
                <% if get_columns(params).include?("contact_name") %>
                    <th class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Tên khách hàng</th>
                <% end %>
                <% if get_columns(params).include?("voucher_date") %>
                    <th width="12%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Ngày thanh toán</th>
                <% end %>
                <% if get_columns(params).include?("pay_receive") %>
                    <th width="15%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Loại phiếu</th>
                <% end %>
                <% if get_columns(params).include?("description") %>
                    <th width="15%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Diễn giải</th>
                <% end %>
                <% if get_columns(params).include?("amount") %>
                    <th width="12%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Số tiền</th>
                <% end %>
                <% if get_columns(params).include?("account") %>
                    <th width="15%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">TK thanh toán</th>
                <% end %>
                <% if get_columns(params).include?("salesperson") %>
                    <th width="15%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">NV phụ trách</th>
                <% end %>
            </tr>
        </thead>
        <tbody>
            <% if @payment_records.empty? %>
                <tr>
                    <td class="bg-green-jungle bg-font-green-jungle text-center" colspan="<%= total_colspan+1 %>"><%= t('.no_matching_records_found') %></td>
                </tr>
            <% else %>
                <% if get_columns(params).include?("amount") %>
                    <tr>
                        <td class="bg-green-jungle bg-font-green-jungle text-center" colspan="<%= total_colspan %>"><strong> TỔNG CỘNG </strong></td>
                        <td class="bg-green-jungle bg-font-green-jungle text-right"><strong><%= format_number(@payment_records.remain_amount(from_date: @from, to_date: @to)) %></strong></td>
                        <% if get_columns(params).include?("account") %>
                            <td class="bg-green-jungle bg-font-green-jungle text-right"></td>
                        <% end %>
                        <% if get_columns(params).include?("salesperson") %>
                            <td class="bg-green-jungle bg-font-green-jungle text-right"></td>
                        <% end %>
                    </tr>
                <% end %>
            <% end %>
            <% @payment_records.each_with_index do |payment_record, index| %>
                <tr>
                    <% if get_columns(params).include?("ordinal_number") %>
                        <td class="text-center"><%= index+1 %></td>
                    <% end %>
                    <% if get_columns(params).include?("contact_name") %>
                        <td class="text-left"><%= payment_record.customer_name %></td>
                    <% end %>
                    <% if get_columns(params).include?("voucher_date") %>
                        <td class="text-left"><%= format_date(payment_record.payment_date) %></td>
                    <% end %>
                    <% if get_columns(params).include?("pay_receive") %>
                        <td class="text-left">
                            <%= t(".#{display_payment_record_type(payment_record)}") %>
                        </td>
                    <% end %>
                    <% if get_columns(params).include?("description") %>
                        <td class="text-left"><%= payment_record.description.html_safe %></td>
                    <% end %>
                    <% if get_columns(params).include?("amount") %>
                        <td class="text-right"><%= format_number(payment_record.amount) %></td>
                    <% end %>
                    <% if get_columns(params).include?("account") %>
                        <td class="text-left"><%= payment_record.account_name %></td>
                    <% end %>
                    <% if get_columns(params).include?("salesperson") %>
                        <td class="text-left"><%= payment_record.employee_name %></td>
                    <% end %>
                </tr>
            <% end %>
        </tbody>
    </table>
<% else %>
    <div class="alert alert-warning"><%= t('.please_select_filter') %></div>
<% end %>