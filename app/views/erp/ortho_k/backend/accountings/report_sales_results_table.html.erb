<% if params.to_unsafe_hash[:global_filter][:from_date].present? ||
      params.to_unsafe_hash[:global_filter][:to_date].present? ||
      params.to_unsafe_hash[:global_filter][:period].present? %>
      
    <div class="custom-show text-center">
        <h4 class="font-blue-madison bold uppercase mb-15">
            Kết quả bán hàng - doanh số trong kỳ
        </h4>
    </div>
    
    <div class="text-right mb-10">
        <a target="_blank"
            href="<%= erp_ortho_k.report_sales_results_xlsx_backend_accountings_path(params.to_unsafe_hash.merge({format: 'xlsx'})) %>"
            target="_blank"
            class="btn btn-primary"
        >Xuất excel</a>
    </div>
    
    <table class="table table-bordered order-column">
        <thead class="flip-content">
            <tr>
                <th width="20%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap uppercase">
                    <%= 'từ ' + @from.strftime('%d/%m/%Y') if !@from.nil? %>
                    <%= 'đến ' + @to.strftime('%d/%m/%Y') if !@to.nil? %>
                </th>
                <th class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Loại hàng hóa</th>
                <th width="20%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Số lượng</th>
                <th width="20%" class="text-center bg-yellow-mint bg-font-yellow-mint text-nowrap">Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            <% @categories.each_with_index do |cat, index| %>
                <tr>
                    <% if index == 0 %>
                        <td class="text-center bold uppercase" rowspan="<%= @categories.count %>">Xuất bán hàng</td>
                    <% end %>
                    <% if index+1 < @categories.count %>
                        <% if cat.get_sales_count(from_date: @from, to_date: @to) > 0 %>
                            <td class="text-left"><%= cat.name %></td>
                            <td class="text-center font-yellow-gold"><%= format_number(cat.get_sales_quantity(from_date: @from, to_date: @to)) %></td>
                            <td class="text-right font-yellow-gold"><%= format_number(cat.get_sales_amount(from_date: @from, to_date: @to)) %></td>
                        <% end %>
                    <% end %>
                    <% if index+1 == @categories.count %>
                        <td class="text-left bold uppercase">Tổng bán</td>
                        <td class="text-center bold"><%= format_number(@categories.total_sales_quantity(from_date: @from, to_date: @to)) %></td>
                        <td class="text-right bold"><%= format_number(@categories.total_sales_amount(from_date: @from, to_date: @to)) %></td>
                    <% end %>
                </tr>
            <% end %>
            <% @categories.each_with_index do |cat, index| %>
                <tr>
                    <% if index == 0 %>
                        <td class="text-center bold uppercase" rowspan="<%= @categories.count %>">Hàng bị trả lại</td>
                    <% end %>
                    <% if index+1 < @categories.count %>
                        <% if cat.get_return_count(from_date: @from, to_date: @to) > 0 %>
                            <td class="text-left"><%= cat.name %></td>
                            <td class="text-center font-yellow-gold"><%= format_number(cat.get_return_quantity(from_date: @from, to_date: @to)) %></td>
                            <td class="text-right font-yellow-gold"><%= format_number(cat.get_return_amount(from_date: @from, to_date: @to)) %></td>
                        <% end %>
                    <% end %>
                    <% if index+1 == @categories.count %>
                        <td class="text-left bold uppercase">Tổng trả</td>
                        <td class="text-center bold"><%= format_number(@categories.total_return_quantity(from_date: @from, to_date: @to)) %></td>
                        <td class="text-right bold"><%= format_number(@categories.total_return_amount(from_date: @from, to_date: @to)) %></td>
                    <% end %>
                </tr>
            <% end %>
            <tr>
                <td class="bg-green-jungle bg-font-green-jungle text-center" colspan="2">
                    <h4 class="bold uppercase" title="Tổng tiền doanh số bán hàng sau khi đã trừ cho chi phí hàng bị trả lại">Tổng cộng</h4>
                </td>
                <td class="bg-green-jungle bg-font-green-jungle text-center"><h4 class="bold"><%= format_number(@categories.total_sales_quantity_without_return(from_date: @from, to_date: @to)) %></h4></td>
                <td class="bg-green-jungle bg-font-green-jungle text-right"><h4 class="bold"><%= format_number(@categories.total_sales_amount_without_return(from_date: @from, to_date: @to)) %></h4></td>
            </tr>
            
        </tbody>
    </table>
<% else %>
    <div class="alert alert-warning"><%= t('.please_select_filter') %></div>
<% end %>