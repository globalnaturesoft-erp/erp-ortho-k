<div class="custom-show text-center">
    <h4 class="font-blue-madison bold uppercase mb-15">
        Tổng công nợ khách hàng <%= @periods.first[:from].year %> và <%= @periods.last[:to].year %>
    </h4>
</div>

<div class="text-right mb-10">
    <a target="_blank"
        href="<%= erp_ortho_k.report_statistics_liabilities_xlsx_backend_accountings_path(params.to_unsafe_hash.merge({format: 'xlsx'})) %>"
        target="_blank"
        class="btn btn-primary"
    >Xuất excel</a>
</div>

<table class="table table-bordered order-column">
    <thead class="flip-content">
        <tr>
            <th width="40%"  class="text-center bg-yellow bg-font-yellow text-nowrap">Danh mục thống kê</th>
            <th width="20%" class="text-right bg-yellow bg-font-yellow text-nowrap">Tổng nợ trong kỳ</th>
            <th width="20%" class="text-right bg-yellow bg-font-yellow text-nowrap">Tổng thu trong kỳ</th>
            <th width="20%" class="text-right bg-yellow bg-font-yellow text-nowrap">Chưa thu trong kỳ</th>
        </tr>
    </thead>
    <tbody>
        <% @periods.each do |period| %>
            <% total_amount = @customers.sales_total_amount(from_date: period[:from], to_date: period[:to]) %>
            <% paid_amount = @customers.sales_paid_by_period_amount(from_date: period[:from], to_date: period[:to]) %>
            <% debt_amount = @customers.sales_debt_by_period_amount(from_date: period[:from], to_date: period[:to]) %>
            <% if total_amount > 0 or paid_amount > 0 or debt_amount > 0 %>
                <tr>
                    <td class="text-center uppercase"><%= period[:name] %></td>
                    <td class="text-right"><%= format_number(total_amount) %></td>
                    <td class="text-right"><%= format_number(paid_amount) %></td>
                    <td class="text-right"><%= format_number(debt_amount) %></td>
                </tr>
            <% end %>
        <% end %>
        <% total_amount = @customers.sales_total_amount(from_date: @periods.first[:from], to_date: @periods.last[:to]) %>
        <% paid_amount = @customers.sales_paid_by_period_amount(from_date: @periods.first[:from], to_date: @periods.last[:to]) %>
        <% debt_amount = @customers.sales_debt_by_period_amount(from_date: @periods.first[:from], to_date: @periods.last[:to]) %>
        <tr>
            <td class="bg-green-jungle bg-font-green-jungle border-green-jungle text-center bold uppercase">Tổng cộng</td>
            <td class="bg-green-jungle bg-font-green-jungle border-green-jungle text-right bold"><%= format_number(total_amount) %></td>
            <td class="bg-green-jungle bg-font-green-jungle border-green-jungle text-right bold"><%= format_number(paid_amount) %></td>
            <td class="bg-green-jungle bg-font-green-jungle border-green-jungle text-right bold"><%= format_number(debt_amount) %></td>
        </tr>
    </tbody>
</table>